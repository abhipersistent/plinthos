<?xml version="1.0" encoding="UTF-8"?>
<project name="Sample Statistics Service" default="build-jar" basedir=".">
  <description>
      _______________________________________________________________________

		             A Sample Statistics Service for PlinthOS
      _______________________________________________________________________
      
          PlinthOS:  Open Source Multi-Core and Distributed Computing
      _______________________________________________________________________
      
      Copyright 2003-2009, Emptoris Inc., and individual contributors
      as indicated by the @author tags. See the copyright.txt file in the
      distribution for a full listing of individual contributors.
     
      This is free software; you can redistribute it and/or modify it
      under the terms of the GNU Lesser General Public License as
      published by the Free Software Foundation; either version 2.1 of
      the License, or (at your option) any later version.
     
      This software is distributed in the hope that it will be useful,
      but WITHOUT ANY WARRANTY; without even the implied warranty of
      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
      Lesser General Public License for more details.
     
      You should have received a copy of the GNU Lesser General Public
      License along with this software; if not, write to the Free
      Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
      02110-1301 USA, or see the FSF site: http://www.fsf.org.

  _______________________                         ___________________
                         \_______________________/                   \________ 
    Happy Multi-Core
                                                   The PlinthOS Team   
       CRUNCHING          _______________________                     ________
  _______________________/                       \___________________/        
      
  </description>

  <property name="app.root"  value="./.." />

  <property name="app.build" value="${app.root}/build" />
  <property name="app.docs"  value="${app.root}/docs" />
  <property name="app.lib"   value="${app.root}/lib" />
  <property name="app.src"   value="${app.root}/src" />

  
  <property name="build.dist"      value="${app.build}/dist" />
  <property name="build.classes"   value="${app.build}/classes" />
  <property name="eclipse.classes" value="${app.build}/bytecode" />
  
  <property name="apidoc.dir" value="${app.docs}/javadoc" />

  <property name="plinthos.lib"  value="c:/Servers/jboss-4.2.3.GA/plinthos-lib" />
  <property name="app.exec.file" value="org.plinthos.sample.statistics.service.BasicStatisticsTask" />
  
  <!-- PREAMPLE -->
  <path id="compile.classpath">
    <pathelement location="${env.CLASSPATH}" />
    <fileset dir="${app.lib}">
      <include name="**/*.jar" />
    </fileset>
  </path>
	
  <target name="init">
    <tstamp>
      <format property="TODAY" pattern="MMM dd, yyyy - hh:mm:ss aa" />
    </tstamp>
    <echo>Started at: ${TODAY}</echo>
  </target>

  <target name="make-build-dirs">
    <mkdir dir="${build.dist}" />
    <mkdir dir="${build.classes}" />
  </target>

  <!-- CREATE THE BYTECODE -->
  <target name="src-compile" depends="init,make-build-dirs">
    <javac srcdir="${app.src}" 
           destdir="${build.classes}" 
           deprecation="off" 
           debug="on" 
           failonerror="yes">
      <classpath refid="compile.classpath" />
    </javac>
  </target>

  <!-- BUILD THE JAR FILE -->
  <target name="build-jar" depends="src-compile">
    <jar basedir="${build.classes}" 
         destfile="${build.dist}/plinthos-stats-service.jar" 
         includes="**/**.class">			
    </jar>
  </target>

  <!-- DEPLOY THE SERVICE AND ITS DEPENDENCIES -->
  <target name="deploy" depends="build-jar">
  
    <!-- If the deployment directory does not exist, create it -->
    <mkdir dir="${plinthos.lib}/${app.exec.file}" />
    
    <!-- Copy the JAR file of the service -->
    <copy file="${build.dist}/plinthos-stats-service.jar"
          todir="${plinthos.lib}/${app.exec.file}"/>
          
    <!-- and all its dependencies -->
    <copy todir="${plinthos.lib}/${app.exec.file}">      
      <fileset dir="${app.lib}">
        <include name="**/*.jar" />
      </fileset>
    </copy>
  </target>
  
  
  <!-- CLEAN UP -->
  <target name="clean" description="clean up" >
    <delete dir="${build.classes}"/>
    <delete dir="${build.dist}"/>
  </target>

  <!-- CLEAN UP EVERYTHING -->
  <target name="tidy"
          depends="clean"
          description="clean up everything, even the Javadocs">

    <delete dir="${apidoc.dir}"/>

    <!-- I use this directory for Eclipse compiled code -->
    <delete dir="${eclipse.classes}"/>
    
    <!-- For those of us who still use Emacs ... sporadically ;-) -->
    <delete> <fileset dir="${app.root}" includes="**/*~" defaultexcludes="no"/> </delete>
  </target>

  <!-- JAVADOC -->
  <target name="docs" 
          depends="init" description="Generates Javadoc for all source code.">

    <mkdir dir="${apidoc.dir}" />

    <javadoc packagenames="org.*"
               sourcepath="${app.src}"
               classpath="${compile.classpath}"
               destdir="${apidoc.dir}"
               windowtitle="PlinthOS Statistics Service API Documentation"
               access="protected"
               author="true"
               version="true"
               use="true" />
    </target>
	
</project>
